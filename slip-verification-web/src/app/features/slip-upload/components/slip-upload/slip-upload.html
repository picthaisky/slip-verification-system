<div class="max-w-4xl mx-auto p-6">
  <mat-card class="mb-6">
    <mat-card-header>
      <mat-card-title>Upload Payment Slip</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Order ID Input -->
        <mat-form-field class="w-full">
          <mat-label>Order ID</mat-label>
          <input matInput formControlName="orderId" placeholder="Enter Order ID">
          <mat-icon matPrefix>receipt</mat-icon>
          @if (uploadForm.get('orderId')?.hasError('required') && uploadForm.get('orderId')?.touched) {
            <mat-error>Order ID is required</mat-error>
          }
        </mat-form-field>

        <!-- File Upload Area -->
        <div class="space-y-4">
          <label class="block text-sm font-medium text-gray-700">Payment Slip Image</label>
          
          @if (!previewUrl()) {
            <div 
              class="border-2 border-dashed rounded-lg p-8 text-center transition-colors"
              [class.border-primary-500]="isDragOver()"
              [class.bg-primary-50]="isDragOver()"
              [class.border-gray-300]="!isDragOver()"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)">
              
              <mat-icon class="text-6xl text-gray-400 mb-4">cloud_upload</mat-icon>
              <p class="text-lg mb-2">Drag and drop your slip image here</p>
              <p class="text-sm text-gray-500 mb-4">or</p>
              
              <label for="file-input" class="cursor-pointer">
                <button type="button" mat-raised-button color="primary" (click)="fileInput.click()">
                  <mat-icon>folder_open</mat-icon>
                  Choose File
                </button>
              </label>
              
              <input 
                #fileInput
                type="file" 
                id="file-input"
                class="hidden" 
                accept="image/jpeg,image/png,image/jpg"
                (change)="onFileSelected($event)">
              
              <p class="text-xs text-gray-500 mt-4">
                Supported formats: JPEG, PNG (Max 5MB)
              </p>
            </div>
          } @else {
            <div class="relative">
              <img [src]="previewUrl()" alt="Preview" class="max-w-full h-auto rounded-lg shadow-lg">
              <button 
                type="button"
                mat-mini-fab 
                color="warn"
                class="absolute top-2 right-2"
                (click)="removeFile()">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          }
        </div>

        <!-- Progress Bar -->
        @if (isUploading()) {
          <div class="space-y-2">
            <div class="flex justify-between text-sm">
              <span>Uploading...</span>
              <span>{{ uploadProgress() }}%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div 
                class="bg-primary-600 h-2 rounded-full transition-all duration-300"
                [style.width.%]="uploadProgress()">
              </div>
            </div>
          </div>
        }

        <!-- Action Buttons -->
        <div class="flex gap-4">
          <button 
            type="submit" 
            mat-raised-button 
            color="primary"
            [disabled]="uploadForm.invalid || isUploading()">
            <mat-icon>upload</mat-icon>
            Upload & Verify
          </button>
          
          <button 
            type="button" 
            mat-stroked-button
            (click)="reset()"
            [disabled]="isUploading()">
            <mat-icon>refresh</mat-icon>
            Reset
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Verification Result -->
  @if (result()) {
    <mat-card>
      <mat-card-header>
        <mat-card-title>Verification Result</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-600">Status</p>
              <p class="font-semibold">{{ result()!.status }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Amount</p>
              <p class="font-semibold">{{ result()!.amount | currency:'THB' }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Reference Number</p>
              <p class="font-semibold">{{ result()!.referenceNumber }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Bank Name</p>
              <p class="font-semibold">{{ result()!.bankName }}</p>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  }
</div>
